{% extends "base.html" %}

{% block title %}ç®¡ç†é¢æ¿ - åˆ·é¢˜ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="admin-page">
    <header class="page-header">
        <h1>ğŸ”§ ç®¡ç†é¢æ¿</h1>
        <div class="header-actions">
            <a href="{{ url_for('login') }}" class="btn btn-outline">ç”¨æˆ·å…¥å£</a>
            <a href="{{ url_for('admin_logout') }}" class="btn btn-outline">é€€å‡ºç®¡ç†</a>
        </div>
    </header>
    
    <div class="admin-grid">
        <!-- å£ä»¤ç®¡ç† -->
        <section class="admin-section">
            <h2>ğŸ“ å£ä»¤ç®¡ç†</h2>
            <p class="section-desc">ç®¡ç†å…è®¸ç™»å½•çš„ç”¨æˆ·å£ä»¤</p>
            
            <form method="POST" action="{{ url_for('add_token') }}" class="inline-form">
                <input type="text" name="token" placeholder="æ–°å£ä»¤" required>
                <button type="submit" class="btn btn-primary">æ·»åŠ å£ä»¤</button>
            </form>
            
            <div class="token-list">
                <h3>å½“å‰å£ä»¤åˆ—è¡¨</h3>
                {% if tokens %}
                <ul class="list">
                    {% for token in tokens %}
                    <li class="list-item">
                        <span class="token-value">{{ token }}</span>
                        <form method="POST" action="{{ url_for('remove_token') }}" class="inline" onsubmit="return confirm('ç¡®å®šåˆ é™¤æ­¤å£ä»¤ï¼Ÿ')">
                            <input type="hidden" name="token" value="{{ token }}">
                            <button type="submit" class="btn btn-danger btn-small">åˆ é™¤</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="empty-text">æš‚æ— å£ä»¤</p>
                {% endif %}
            </div>
        </section>
        
        <!-- ä¿®æ”¹å¯†ç  -->
        <section class="admin-section">
            <h2>ğŸ”‘ ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </h2>
            <form method="POST" action="{{ url_for('change_password') }}" class="form-vertical">
                <div class="form-group">
                    <input type="password" name="new_password" placeholder="æ–°å¯†ç " required>
                </div>
                <button type="submit" class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
            </form>
        </section>
        
        <!-- å…¬å‘Šç®¡ç† -->
        <section class="admin-section full-width">
            <h2>ğŸ“¢ å…¬å‘Šç®¡ç†</h2>
            <p class="section-desc">å‘å¸ƒå’Œç®¡ç†ç³»ç»Ÿå…¬å‘Š</p>
            
            <form method="POST" action="{{ url_for('admin_add_announcement') }}" class="announcement-form">
                <div class="form-group">
                    <input type="text" name="title" placeholder="å…¬å‘Šæ ‡é¢˜" required maxlength="100">
                </div>
                <div class="form-group">
                    <textarea name="content" placeholder="å…¬å‘Šå†…å®¹" required rows="4" maxlength="1000"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">å‘å¸ƒå…¬å‘Š</button>
            </form>
            
            <div class="announcements-list">
                <h3>å·²å‘å¸ƒçš„å…¬å‘Š ({{ announcements|length }})</h3>
                {% if announcements %}
                <div class="announcements-container">
                    {% for ann in announcements %}
                    <div class="announcement-item">
                        <div class="announcement-header">
                            <h4 class="announcement-title">{{ ann.title }}</h4>
                            <span class="announcement-hash">#{{ ann.hash }}</span>
                        </div>
                        <p class="announcement-content">{{ ann.content }}</p>
                        <div class="announcement-footer">
                            <span class="announcement-time">{{ ann.timestamp[:19].replace('T', ' ') }}</span>
                            <form method="POST" action="{{ url_for('admin_delete_announcement') }}" class="inline" onsubmit="return confirm('ç¡®å®šåˆ é™¤æ­¤å…¬å‘Šï¼Ÿ')">
                                <input type="hidden" name="hash" value="{{ ann.hash }}">
                                <button type="submit" class="btn btn-danger btn-small">åˆ é™¤</button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="empty-text">æš‚æ— å…¬å‘Š</p>
                {% endif %}
            </div>
        </section>
        
        <!-- ç”¨æˆ·ç»Ÿè®¡ -->
        <section class="admin-section full-width">
            <h2>ğŸ“Š ç”¨æˆ·ç»ƒä¹ ç»Ÿè®¡</h2>
            {% if users_stats %}
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ç”¨æˆ·æ•°æ®æ–‡ä»¶</th>
                            <th>å·²ç­”é¢˜æ•°</th>
                            <th>æ­£ç¡®é¢˜æ•°</th>
                            <th>æ­£ç¡®ç‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users_stats %}
                        <tr>
                            <td>{{ user.file }}</td>
                            <td>{{ user.total_answered }}</td>
                            <td>{{ user.total_correct }}</td>
                            <td>
                                {% if user.total_answered > 0 %}
                                    {{ (user.total_correct / user.total_answered * 100)|round(1) }}%
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</p>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}
